<!-- Copyright (c) 2018 BlackBerry Ltd.
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    *
    */
-->

<!DOCTYPE HTML>
<script nonce="Placeholder to be replaced by ResponseBuilder.">
var bridge;
(function(){function l(b){console.log("postMessage("+JSON.stringify(b)+') "'+bridge.postMessage(JSON.stringify(b))+'"')}function x(){f.xhrOpen.apply(this,arguments);this.shadowXMLHttpRequest.method=arguments[0];this.shadowXMLHttpRequest.url=arguments[1]}function y(){var b=arguments[0]||"";if(!e.METHODS_DONT_SUPPORT_BODY.includes(this.shadowXMLHttpRequest.method.toUpperCase())){var a=k(),c=window.document.createElement("a"),d="";c.href=this.shadowXMLHttpRequest.url;c=c.href;a=p(this.shadowXMLHttpRequest.url,"gd_uuid_gd",
a);if(b.shadowFormData){b.shadowFormData.sendFormData(this);return}if(b.constructor==Blob){z(b,this);return}b.constructor==ArrayBuffer&&(b=(new Uint8Array(b)).toString(),d="ArrayBuffer");l({uniqueAction:a,origAction:c,requestBody:b,sourceMessage:"XMLHttpRequest",type:d});this.setRequestHeader(e.GD_HEADER,a)}f.xhrSend.apply(this,arguments)}function A(b,a,c){f.formDataAppend.apply(this,arguments);this.shadowFormData.entries||(this.shadowFormData.entries=[]);if("object"===typeof a){var d=new FileReader;
if(a.constructor===Blob)var m=c||"blob";else a.constructor===File&&(m=a.name);var e={name:b,value:a,fileName:m,loaded:!1,dataURL:null};this.shadowFormData.entries.push(e);e.reader=d;d.onload=function(){e.dataURL=this.result;e.loaded=!0};d.readAsDataURL(e.value)}else this.shadowFormData.entries.push({name:b,value:a,loaded:!0})}function r(b){var a=!1,c=this;this.forEach(function(a){a.loaded||(a.reader.readyState===FileReader.DONE?(a.loaded=!0,a.dataURL=a.reader.result):a.reader.patched||(a.reader.addEventListener("load",
function(){r.call(c,b)}),a.reader.patched=!0))});a=t.apply(c);if(!a){a=e.BOUNDARY_PREFIX+Date.now().toString(16);window.document.createElement("a").href=b.shadowXMLHttpRequest.url;var d=k();d=p(b.shadowXMLHttpRequest.url,"gd_uuid_gd",d);b.setRequestHeader(e.GD_HEADER,d);l({uniqueAction:d,origAction:b.shadowXMLHttpRequest.url,requestBody:u.call(c),sourceMessage:"XMLHttpRequest",boundary:a,contentType:e.FORM_DATA});b.setRequestHeader("Content-Type","gd-form-data");f.xhrSend.call(b)}}function q(b,a){for(var c=
b.elements,d=[],e=0,f=c.length;e<f;e++){var g=c[e],n=g.hasAttribute("name")?g.getAttribute("name"):!1;if(n){var h="INPUT"===g.nodeName.toUpperCase()?g.getAttribute("type").toUpperCase():"TEXT";if("RADIO"!==h&&"CHECKBOX"!==h&&"FILE"!==h&&"SUBMIT"!==h)d.push({name:n,value:g.value,loaded:!0});else if("FILE"===h)if(0<g.files.length){g=g.files;h=0;for(var l=g.length;h<l;h++){var k=g[h];a?B.call(d,k,n):d.push({name:n,value:k.name,loaded:!0})}}else a?d.push({name:n,value:{size:!0,type:"application/octet-stream"},
fileName:"",loaded:!0,dataURL:""}):d.push({name:n,value:"",loaded:!0})}}return d}function B(b,a){var c=new FileReader,d={name:a,value:b,fileName:b.name,loaded:!1,dataURL:null};this.push(d);d.reader=c;c.onload=function(){d.dataURL=this.result;d.loaded=!0};c.readAsDataURL(d.value)}function C(){var b=q(this,!1),a=this.enctype===e.URL_ENCODE?"&":"\n\r";return b.map(function(a){return encodeURIComponent(a.name)+"="+encodeURIComponent(a.value)}).join(a)}function t(){return 0<this.filter(function(b){return!b.loaded}).length}
function k(){var b=new Uint32Array(4);window.crypto.getRandomValues(b);var a=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){a++;var d=b[a>>3]>>a%8*4&15;return("x"==c?d:d&3|8).toString(16)})}function p(b,a,c){a=encodeURIComponent(a);var d=window.document.createElement("a");a+=c?"="+encodeURIComponent(c):"";d.href=b;d.search+=(d.search?"&":"")+a;return d.href}function u(){return this.map(function(b){return{name:b.name,fileName:b.fileName||"",value:b.value.size?"":b.value,
mimetype:b.value.type||"",fileContent:b.reader?b.reader.result:""}})}function v(b){var a=this.target;if(a.action){if(a.__isDefaultPrevented||e.METHODS_DONT_SUPPORT_BODY.includes(a.method.toUpperCase()))return!0;var c=p(a.action,"gd_uuid_gd",k());b={strDbg:b,uniqueAction:c,event:this};if(a.enctype===e.FORM_DATA)c=q(a,!0),w.call(c,a,b);else{c=a.action;var d=a.enctype===e.URL_ENCODE?e.URL_ENCODE:"text/plain";a.setAttribute("action",b.uniqueAction);l({uniqueAction:b.uniqueAction,origAction:c,requestBody:C.call(a),
sourceMessage:b.strDbg,contentType:d});"js_submit"==b.strDbg&&f.htmlSubmit.call(a)}return!0}}function w(b,a){var c=!1,d=this;this.forEach(function(c){c.loaded||(a.event.preventDefault&&(a.event.preventDefault(),a.event.__forceCallSubmit=!0),c.reader.readyState===FileReader.DONE?(c.loaded=!0,c.dataURL=c.reader.result):c.reader.patched||(c.reader.addEventListener("load",function(){w.call(d,b,a)}),c.reader.patched=!0))});c=t.apply(d);if(!c){c=e.BOUNDARY_PREFIX+Date.now().toString(16);window.document.createElement("a").href=
b.target;var m=k(),q=b.action;m=p(b.action,"gd_uuid_gd",m);b.setAttribute("action",m);b.__sent||(l({uniqueAction:m,origAction:q,requestBody:u.call(d),sourceMessage:a.strDbg,boundary:c,contentType:e.FORM_DATA}),b.__sent=!0,(a.event.__forceCallSubmit||"js_submit"==a.strDbg)&&f.htmlSubmit.apply(b))}}function D(b){b={target:this};v.call(b,"js_submit")}function z(b,a){var c=new FileReader;c.addEventListener("load",function(){window.document.createElement("a").href=a.shadowXMLHttpRequest.url;var d=k();
d=p(a.shadowXMLHttpRequest.url,"gd_uuid_gd",d);a.setRequestHeader(e.GD_HEADER,d);l({uniqueAction:d,origAction:a.shadowXMLHttpRequest.url,requestBody:c.result,sourceMessage:"XMLHttpRequest",contentType:b.type,type:"Blob"});f.xhrSend.call(a)});c.readAsDataURL(b)}bridge.postMessage(JSON.stringify({trace:"inject html 0",cookie:document.cookie,location:window.location}));var e={METHODS_DONT_SUPPORT_BODY:["GET","HEAD"],FORM_DATA:"multipart/form-data",URL_ENCODE:"application/x-www-form-urlencoded",BOUNDARY_PREFIX:"-------GDWebKitFormBoundary",
GD_HEADER:"X-GD-UUID"},f=new function(){var b=FormData;var a=FormData.prototype.append;var c=XMLHttpRequest;var d=XMLHttpRequest.prototype.send;var e=XMLHttpRequest.prototype.open;var f=HTMLFormElement.prototype.submit;Object.defineProperties(this,{FormData:{get:function(){return b}},formDataAppend:{get:function(){return a}},XMLHttpRequest:{get:function(){return c}},xhrOpen:{get:function(){return e}},xhrSend:{get:function(){return d}},htmlSubmit:{get:function(){return f}}})};XMLHttpRequest.prototype.__patched||
(XMLHttpRequest.prototype.open=x,XMLHttpRequest.prototype.send=y,Object.defineProperty(XMLHttpRequest.prototype,"__patched",{value:!0}));XMLHttpRequest=function(){var b={},a=new f.XMLHttpRequest;if(a.hasOwnProperty("shadowXMLHttpRequest"))return a;Object.defineProperty(a,"shadowXMLHttpRequest",{get:function(){return b}});return a};FormData.prototype.__patched||(FormData.prototype.append=A,Object.defineProperty(FormData.prototype,"__patched",{value:!0}));FormData=function(b){var a=b?new f.FormData(b):
new f.FormData,c={sendFormData:function(a){r.call(c.entries,a)},entries:[]};b&&(c.form=b,c.entries=q(c.form,!0));Object.defineProperty(a,"shadowFormData",{get:function(){return c}});return a};window.document.addEventListener("submit",function(b){return v.call(b,"html_submit")},!1);window.document.addEventListener("submit",function(b){var a=b.target;if(a.onsubmit&&!a.alreadyHooked){a.alreadyHooked=!0;var c=a.onsubmit;a.onsubmit=function(){var b=c.call(a);a.__isDefaultPrevented=!b;return b}}},{capture:!0});
HTMLFormElement.prototype.__patched||(HTMLFormElement.prototype.submit=D,Object.defineProperty(HTMLFormElement.prototype,"__patched",{value:!0}));bridge.postMessage("{'trace':'inject html 1'}")})();
</script>